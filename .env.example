# ============================================
# OpenChat Server 环境配置示例
# 复制此文件为 .env 并填写实际值
# ============================================

# ============================================
# 基础配置
# ============================================

# 应用环境
NODE_ENV=development

# 应用端口
PORT=3000
HOST=0.0.0.0

# ============================================
# 数据库配置 (支持外部数据库)
# ============================================

# 数据库主机地址 (使用外部数据库时填写外部地址)
DB_HOST=localhost
# 数据库端口
DB_PORT=5432
# 数据库用户名
DB_USER=openchat
# 数据库密码 (生产环境必须修改)
DB_PASSWORD=your-secure-password
# 数据库名称
DB_NAME=openchat

# 数据库连接池配置
DB_POOL_MAX=20
DB_POOL_MIN=5
DB_IDLE_TIMEOUT=30000
DB_CONNECTION_TIMEOUT=5000
DB_MAX_LIFETIME=300000

# 数据库同步 (开发环境 true, 生产环境 false)
DB_SYNCHRONIZE=true
# 数据库日志
DB_LOGGING=false

# 使用外部数据库 (true=使用外部, false=使用docker-compose中的数据库)
USE_EXTERNAL_DB=false

# ============================================
# Redis 配置 (支持外部 Redis)
# ============================================

# Redis 主机地址 (使用外部 Redis 时填写外部地址)
REDIS_HOST=localhost
# Redis 端口
REDIS_PORT=6379
# Redis 密码 (生产环境建议设置)
REDIS_PASSWORD=
# Redis 数据库编号
REDIS_DB=0
# 队列使用独立的数据库
REDIS_QUEUE_DB=1

# Redis 连接配置
REDIS_CONNECT_TIMEOUT=10000
REDIS_MAX_RETRIES=3
# Redis 最大内存
REDIS_MAX_MEMORY=256mb
# Redis 内存策略
REDIS_MAX_MEMORY_POLICY=allkeys-lru

# 使用外部 Redis (true=使用外部, false=使用docker-compose中的Redis)
USE_EXTERNAL_REDIS=false

# ============================================
# JWT 配置
# ============================================

# JWT 密钥 (生产环境必须修改，必须至少32个字符)
JWT_SECRET=your-jwt-secret-at-least-32-characters-long
# JWT 过期时间
JWT_EXPIRES_IN=7d
# JWT 刷新过期时间
JWT_REFRESH_EXPIRES_IN=30d

# ============================================
# 安全配置
# ============================================

# CORS 允许的来源
CORS_ORIGINS=http://localhost:3000,http://localhost:5173
# 请求限流
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=100
# BCrypt 加密轮数
BCRYPT_SALT_ROUNDS=10

# ============================================
# 悟空IM 配置 (支持外部 IM)
# ============================================

# 悟空IM API 地址
WUKONGIM_API_URL=http://localhost:5001
# 悟空IM TCP 地址
WUKONGIM_TCP_ADDR=localhost:5100
# 悟空IM WebSocket 地址
WUKONGIM_WS_URL=ws://localhost:5200
# 悟空IM 管理地址
WUKONGIM_MANAGER_URL=http://localhost:5300
# 悟空IM Token 认证
WUKONGIM_TOKEN_AUTH=false
# 悟空IM 请求超时 (毫秒)
WUKONGIM_TIMEOUT=10000
# 悟空IM 应用ID
WUKONGIM_APP_ID=
# 悟空IM 应用密钥
WUKONGIM_APP_SECRET=

# 使用外部 IM (true=使用外部, false=使用docker-compose中的IM)
USE_EXTERNAL_WK=false

# ============================================
# 悟空IM 服务端配置 (Docker环境)
# ============================================

# 镜像版本
WUKONGIM_IMAGE=registry.cn-shanghai.aliyuncs.com/wukongim/wukongim:v2

# 集群配置
WK_CLUSTER_NODEID=1001
WK_MODE=release

# 外部/内部 IP (音视频通话需要)
EXTERNAL_IP=127.0.0.1
INTERNAL_IP=127.0.0.1

# 集群配置
WK_CLUSTER_SERVERADDR=wukongim:11110

# 性能配置
WK_CONN_MAX=10000
WK_CHANNEL_MAX=1000
WK_MAX_CHANNELS_PER_USER=100

# 日志配置
WK_LOG_LEVEL=info
WK_LOG_MAX_SIZE=100
WK_LOG_MAX_FILES=7

# 消息配置
WK_MSG_MAX_SIZE=4096
WK_MSG_CACHE_SIZE=1000
WK_MSG_GC_INTERVAL=300

# 存储配置 (sqlite, mysql, postgres)
WK_STORE_TYPE=sqlite
WK_STORE_PATH=/root/wukongim/data

# Redis 配置（用于分布式）
WK_REDIS_HOST=
WK_REDIS_PORT=6379
WK_REDIS_PASSWORD=
WK_REDIS_DB=0

# Token 配置
WK_TOKEN_SECRET=
WK_TOKEN_EXPIRE=86400

# Webhook 配置
WK_WEBHOOK_ENABLED=false
WK_WEBHOOK_URL=
WK_WEBHOOK_TIMEOUT=5000

# 限流配置
WK_RATE_LIMIT_ENABLED=true
WK_RATE_LIMIT_MAX=100
WK_RATE_LIMIT_WINDOW=60

# ============================================
# 队列配置
# ============================================

# 启用消息队列
QUEUE_ENABLED=true

# ============================================
# 音视频 RTC 配置 (可选)
# ============================================

# 火山引擎配置
VOLCENGINE_APP_ID=
VOLCENGINE_APP_KEY=
VOLCENGINE_APP_SECRET=

# ============================================
# AI Bot 配置 (可选)
# ============================================

# OpenAI API Key
OPENAI_API_KEY=
# OpenAI 模型
OPENAI_MODEL=gpt-3.5-turbo

# ============================================
# 第三方平台配置 (可选)
# ============================================

TELEGRAM_BOT_TOKEN=
WHATSAPP_API_KEY=

# ============================================
# 限流配置
# ============================================

THROTTLE_TTL=60000
THROTTLE_LIMIT=100

# ============================================
# 日志配置
# ============================================

# 日志级别: debug, info, warn, error
LOG_LEVEL=info
# 日志格式: json, pretty
LOG_FORMAT=json
# 启用文件日志
LOG_FILE_ENABLED=false
# 日志文件目录
LOG_FILE_DIR=./logs
# 日志文件大小限制
LOG_FILE_MAX_SIZE=10m
# 日志文件保留天数
LOG_FILE_MAX_FILES=7
# 启用日志压缩
LOG_FILE_COMPRESS=true

# ============================================
# 性能优化配置
# ============================================

# 慢查询阈值 (毫秒)
SLOW_QUERY_THRESHOLD=1000
# 数据库查询超时 (毫秒)
DB_QUERY_TIMEOUT=30000
# 批量操作大小
BATCH_SIZE=100
# 最大并发数
CONCURRENCY_MAX=10
# 队列大小
CONCURRENCY_QUEUE_SIZE=1000
# 并发超时 (毫秒)
CONCURRENCY_TIMEOUT=30000

# ============================================
# 缓存配置
# ============================================

# 启动时预热缓存
CACHE_WARMUP_ON_START=false
# 默认缓存 TTL (秒)
CACHE_DEFAULT_TTL=300
# 空值缓存 TTL (秒)
CACHE_NULL_TTL=60

# ============================================
# Docker Compose 配置
# ============================================

# 重启策略: always, unless-stopped, on-failure, no
RESTART_POLICY=unless-stopped

# 应用镜像
DOCKER_REGISTRY=
APP_VERSION=latest

# PostgreSQL 版本
POSTGRES_VERSION=15-alpine
# Redis 版本
REDIS_VERSION=7-alpine

# 镜像版本
PROMETHEUS_VERSION=v2.48.0

# 资源限制
APP_MEMORY_LIMIT=1G
APP_MEMORY_RESERVE=512M
POSTGRES_MEMORY_LIMIT=1G
POSTGRES_MEMORY_RESERVE=512M
REDIS_MEMORY_LIMIT=512M
REDIS_MEMORY_RESERVE=256M
WUKONGIM_MEMORY_LIMIT=1G
WUKONGIM_MEMORY_RESERVE=512M

# 网络配置
NETWORK_NAME=openchat-network
NETWORK_SUBNET=172.28.0.0/16

# 应用端口映射
APP_PORT=3000

# WukongIM 端口映射
WUKONGIM_API_PORT=5001
WUKONGIM_TCP_PORT=5100
WUKONGIM_WS_PORT=5200
WUKONGIM_MANAGER_PORT=5300
WUKONGIM_CLUSTER_PORT=11110
